! This file is part of the FEPX software package.
! Copyright (C) 1996-2020, DPLab, ACME Lab.
! See the COPYING file in the top-level directory.
!
MODULE QUADRATURE_MOD
!
! Module contains element quadrature rules. Considers 10 node tetrahedral
!   elements containing 15 integration points, and 6 node triangular elements
!   (for surface calculations) containing 7 integration points.
!
! Rule from P. Keast, "Moderate-Degree Tetrahedral Quadrature Formulas",
!   Computer Meth. Appl. Mechanics Eng. 55 (1986), pp 339-348.
!
! Integrates 5th order polynomial exactly on tetrahedron
!
! Contains subroutines:
! INITIALIZE: Sets up quadrature rules
!
! From libf95:
!
USE INTRINSIC_TYPES_MOD, ONLY: RK=>REAL_KIND
!
IMPLICIT NONE
!
! Public
!
INTEGER, PARAMETER :: NQPT = 15
INTEGER, PARAMETER :: NQPT1 = NQPT - 1
INTEGER, PARAMETER, PRIVATE :: MAX_Q = NQPT1
INTEGER, PARAMETER :: MAXQP3D = NQPT
INTEGER, PARAMETER :: MAXQP2D = 7
INTEGER, PARAMETER :: NDIM3 = 3
INTEGER, PARAMETER :: NDIM2 = 2
INTEGER :: NQP3D = MAXQP3D
INTEGER :: NQP2D = MAXQP2D
REAL(RK) :: QPLOC(0:2, 0:MAX_Q)
REAL(RK) :: WTQP (0:2, 0:MAX_Q)
REAL(RK) :: QP3D(NDIM3, MAXQP3D), QP2D(NDIM2, MAXQP2D)
REAL(RK) :: WT3D(MAXQP3D), WT2D(MAXQP2D)
!
CONTAINS
    !
    SUBROUTINE INITIALIZE()
    !
    ! Set up quadrature rule.
    !
    !---------------------------------------------------------------------------
    !
    IMPLICIT NONE
    !
    ! Arguments:
    ! None
    !
    ! Locals:
    ! None
    !
    !---------------------------------------------------------------------------
    !
    ! 3D quadrature point locations
    !
    QPLOC(0,0) =  0.333333333333333333D0
    QPLOC(0,1) =  0.333333333333333333D0
    QPLOC(0,2) =  0.333333333333333333D0
    QPLOC(0,3) =  0.0D0
    QPLOC(0,4) =  0.25D0
    QPLOC(0,5) =  0.909090909090909091D-1
    QPLOC(0,6) =  0.909090909090909091D-1
    QPLOC(0,7) =  0.909090909090909091D-1
    QPLOC(0,8) =  0.727272727272727273D0
    QPLOC(0,9) =  0.665501535736642813D-1
    QPLOC(0,10) = 0.665501535736642813D-1
    QPLOC(0,11) = 0.665501535736642813D-1
    QPLOC(0,12) = 0.433449846426335728D0
    QPLOC(0,13) = 0.433449846426335728D0
    QPLOC(0,14) = 0.433449846426335728D0
    !
    QPLOC(1,0) =  0.333333333333333333D0
    QPLOC(1,1) =  0.333333333333333333D0
    QPLOC(1,2) =  0.0D0
    QPLOC(1,3) =  0.333333333333333333D0
    QPLOC(1,4) =  0.25D0
    QPLOC(1,5) =  0.909090909090909091D-1
    QPLOC(1,6) =  0.909090909090909091D-1
    QPLOC(1,7) =  0.727272727272727273D0
    QPLOC(1,8) =  0.909090909090909091D-1
    QPLOC(1,9) =  0.665501535736642813D-1
    QPLOC(1,10) = 0.433449846426335728D0
    QPLOC(1,11) = 0.433449846426335728D0
    QPLOC(1,12) = 0.665501535736642813D-1
    QPLOC(1,13) = 0.665501535736642813D-1
    QPLOC(1,14) = 0.433449846426335728D0
    !
    QPLOC(2,0) =  0.333333333333333333D0
    QPLOC(2,1) =  0.0D0
    QPLOC(2,2) =  0.333333333333333333D0
    QPLOC(2,3) =  0.333333333333333333D0
    QPLOC(2,4) =  0.25D0
    QPLOC(2,5) =  0.909090909090909091D-1
    QPLOC(2,6) =  0.727272727272727273D0
    QPLOC(2,7) =  0.909090909090909091D-1
    QPLOC(2,8) =  0.909090909090909091D-1
    QPLOC(2,9) =  0.433449846426335728D0
    QPLOC(2,10) = 0.665501535736642813D-1
    QPLOC(2,11) = 0.433449846426335728D0
    QPLOC(2,12) = 0.665501535736642813D-1
    QPLOC(2,13) = 0.433449846426335728D0
    QPLOC(2,14) = 0.665501535736642813D-1
    !
    ! 3D quadrature point weights
    !
    WTQP(0,0:3)   = 0.602678571428571597D-2
    WTQP(0,4)     = 0.302836780970891856D-1
    WTQP(0,5:8)   = 0.116452490860289742D-1
    WTQP(0,9:14)  = 0.109491415613864534D-1
    !
    ! 6 node triangular element (2D)
    !
    ! 2D quadrature point locations
    !
    QP2D(1,1)=0.33333333333333D0
    QP2D(1,2)=0.05971587178977D0
    QP2D(1,3)=0.47014206410512D0
    QP2D(1,4)=0.47014206410512D0
    QP2D(1,5)=0.79742698535309D0
    QP2D(1,6)=0.10128650732346D0
    QP2D(1,7)=0.10128650732346D0
    !
    QP2D(2,1)=0.33333333333333D0
    QP2D(2,2)=0.47014206410512D0
    QP2D(2,3)=0.05971587178977D0
    QP2D(2,4)=0.47014206410512D0
    QP2D(2,5)=0.10128650732346D0
    QP2D(2,6)=0.79742698535309D0
    QP2D(2,7)=0.10128650732346D0
    !
    ! 2D quadrature point weights
    !
    WT2D(1) = 0.1125D0
    WT2D(2) = 0.06619707639425D0
    WT2D(3) = 0.06619707639425D0
    WT2D(4) = 0.06619707639425D0
    WT2D(5) = 0.06296959027241D0
    WT2D(6) = 0.06296959027241D0
    WT2D(7) = 0.06296959027241D0
    !
    END SUBROUTINE INITIALIZE
    !
END MODULE QUADRATURE_MOD
